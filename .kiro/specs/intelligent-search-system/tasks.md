# 구현 계획

- [x] 1. 프로젝트 구조 및 기본 설정 구성
  - 마이크로서비스 디렉토리 구조 생성 (services/api-gateway, services/data-collection 등)
  - Docker 및 Docker Compose 설정 파일 작성
  - 공통 라이브러리 및 데이터 모델 정의
  - _요구사항: 1.1, 2.1_

- [x] 2. 데이터 수집 서비스 구현
  - [x] 2.1 데이터베이스 연결 모듈 구현
    - JDBC/ODBC 연결 설정 및 연결 풀 관리 코드 작성
    - 데이터베이스 연결 실패 시 지수 백오프 재시도 로직 구현
    - 연결 상태 모니터링 및 로깅 기능 추가
    - _요구사항: 1.1, 1.2, 1.3_

  - [x] 2.2 문서 추출 및 스키마 감지 기능 구현
    - 지정된 테이블에서 텍스트 및 메타데이터 추출 코드 작성
    - 테이블 스키마 자동 감지 및 변경 감지 로직 구현
    - 증분 업데이트 추출 기능 구현 (타임스탬프 기반)
    - _요구사항: 2.1, 2.2, 2.3_

  - [x] 2.3 데이터 수집 API 엔드포인트 구현
    - FastAPI 기반 데이터 수집 트리거 API 작성
    - 수집 상태 조회 및 로그 확인 API 구현
    - 에러 처리 및 상태 코드 반환 로직 추가
    - _요구사항: 2.1, 8.1_

- [x] 3. 문서 처리 서비스 구현
  - [x] 3.1 한국어 문서 구조화 모듈 구현
    - JSON 스키마 자동 매핑 기능 구현
    - 문서 타입 분류 로직 작성 (행정문서, 민원문서, 조례문서)
    - 문서 메타데이터 추출 및 정규화 기능 구현
    - _요구사항: 3.1, 3.2_

  - [x] 3.2 한국어 특화 청킹 시스템 구현
    - KoNLPy 기반 한국어 토크나이저 설정
    - 구조 기반 청킹 로직 구현 (문단, 조항, 항목 단위)
    - 의미 기반 청킹 로직 구현 (100-1000자 범위, 50자 오버랩)
    - 청킹 실패 시 대안 전략 (문장 단위 분할) 구현
    - _요구사항: 3.2, 3.3, 3.4_

  - [x] 3.3 문서 처리 파이프라인 통합
    - 문서 처리 워크플로우 구현 (구조화 → 분류 → 청킹)
    - 배치 처리 기능 구현 (처리 상태 추적 포함)
    - 처리 결과 검증 및 품질 체크 로직 추가
    - _요구사항: 3.1, 9.1, 9.2_

- [x] 4. 벡터 서비스 구현
  - [x] 4.1 BGE KoBase 임베딩 모델 설정
    - BGE KoBase 모델 로딩 및 초기화 코드 작성
    - SentenceTransformer 대안 모델 설정 (klue/roberta-base)
    - 모델 버전 관리 및 자동 다운로드 기능 구현
    - _요구사항: 4.1, 4.2_

  - [x] 4.2 배치 벡터화 시스템 구현
    - 배치 크기 32로 최적화된 벡터화 로직 작성
    - GPU 활용 가능 시 CUDA 가속 설정
    - 벡터화 진행률 표시 및 성능 모니터링 추가
    - 벡터화 실패 시 단일 문서 처리 모드 구현
    - _요구사항: 4.3, 4.4, 4.5_

  - [x] 4.3 벡터 데이터베이스 인덱싱 구현
    - Chroma DB 연결 및 컬렉션 관리 코드 작성
    - 문서 타입별 별도 컬렉션 생성 로직 구현
    - 벡터와 메타데이터 저장 기능 구현
    - FAISS 대안 인덱스 구현 (IVF_FLAT, HNSW)
    - _요구사항: 5.1, 5.2, 5.3_

  - [x] 4.4 인덱스 무결성 검증 시스템 구현
    - 샘플 쿼리를 통한 인덱스 검증 로직 작성
    - 응답 시간 측정 및 성능 임계값 체크 (1초 이내)
    - 인덱스 손상 감지 및 자동 복구 기능 구현
    - _요구사항: 5.4, 5.5_

- [-] 5. 검색 서비스 구현
  - [x] 5.1 벡터 유사도 검색 엔진 구현
    - 쿼리 벡터화 및 코사인 유사도 검색 로직 작성
    - Top-K 검색 결과 반환 기능 구현 (기본값 5)
    - 유사도 점수 0.7 이상 필터링 로직 추가
    - 문서 타입별 검색 범위 제한 기능 구현
    - _요구사항: 6.1, 6.2_

  - [ ] 5.2 LLM 기반 응답 생성 시스템 구현
    - KoAlpaca 또는 LLaMA 2 모델 로딩 및 설정
    - 한국어 공공문서 스타일 프롬프트 템플릿 작성
    - 검색된 컨텍스트 기반 응답 생성 로직 구현
    - 관련 정보 없을 시 기본 응답 처리 로직 추가
    - _요구사항: 6.3, 6.4, 6.6_

  - [ ] 5.3 검색 결과 후처리 및 메타데이터 추가
    - 소스 문서명, 조항/항목 정보 추출 로직 구현
    - 신뢰도 점수 계산 및 반환 기능 추가
    - 검색 결과 캐싱 시스템 구현 (Redis 기반)
    - 검색 이력 저장 및 분석 기능 추가
    - _요구사항: 6.5, 6.6_

- [ ] 6. API Gateway 서비스 구현
  - [ ] 6.1 FastAPI 기반 API Gateway 구현
    - 모든 서비스 라우팅 및 프록시 기능 구현
    - JWT 기반 인증 시스템 구현
    - API 문서 자동 생성 (Swagger) 설정
    - 요청/응답 로깅 미들웨어 추가
    - _요구사항: 6.1, 6.5_

  - [ ] 6.2 검색 API 엔드포인트 구현
    - POST /api/v1/search 엔드포인트 구현
    - 요청 검증 및 파라미터 처리 로직 추가
    - 응답 형식 표준화 및 에러 처리 구현
    - 동시 요청 처리 및 부하 제한 기능 추가
    - _요구사항: 6.1, 6.3, 6.5_

  - [ ] 6.3 관리자 API 엔드포인트 구현
    - 문서 수집 트리거 API 구현
    - 시스템 상태 조회 API 구현
    - 평가 실행 API 구현
    - 관리자 권한 검증 로직 추가
    - _요구사항: 2.1, 7.1, 8.3_

- [ ] 7. 평가 시스템 구현
  - [ ] 7.1 AutoEval 평가 프레임워크 구현
    - 질문-정답 데이터셋 로딩 및 관리 기능 구현
    - Top-1, Top-3, Top-5 정확도 계산 로직 작성
    - MRR, NDCG@K 지표 계산 기능 구현
    - _요구사항: 7.1, 7.2_

  - [ ] 7.2 LLM 응답 품질 평가 구현
    - BLEU, ROUGE, BERTScore 지표 계산 로직 작성
    - 한국어 특화 평가 메트릭 추가
    - 평가 결과 비교 및 분석 기능 구현
    - _요구사항: 7.3_

  - [ ] 7.3 성능 모니터링 및 알림 시스템 구현
    - 성능 지표 변화 추이 분석 로직 구현
    - 임계값 기반 알림 시스템 구현 (Top-5 정확도 80%)
    - 상세 성능 보고서 생성 기능 구현
    - 자동 최적화 제안 로직 추가
    - _요구사항: 7.4, 7.5_

- [ ] 8. 스케줄링 및 배치 처리 시스템 구현
  - [ ] 8.1 APScheduler 기반 작업 스케줄러 구현
    - 일간/주간/월간 스케줄 설정 기능 구현
    - 작업 큐 관리 및 우선순위 처리 로직 추가
    - 스케줄 상태 모니터링 및 로깅 기능 구현
    - _요구사항: 10.1, 10.3_

  - [ ] 8.2 증분 업데이트 배치 처리 구현
    - 변경된 문서만 감지하여 처리하는 로직 구현
    - 체크포인트 기반 중단/재개 기능 구현
    - 배치 처리 진행률 및 예상 완료 시간 표시
    - _요구사항: 9.1, 9.2, 9.3, 10.2_

  - [ ] 8.3 작업 실패 처리 및 알림 시스템 구현
    - 최대 3회 재시도 로직 구현
    - 최종 실패 시 관리자 알림 발송 기능 구현
    - 작업 실행 이력 및 성능 통계 저장
    - 웹 대시보드를 통한 모니터링 화면 구현
    - _요구사항: 10.4, 10.5_

- [ ] 9. 오류 처리 및 로깅 시스템 구현
  - [ ] 9.1 통합 오류 모니터링 시스템 구현
    - 오류 분류 및 임계값 기반 알림 시스템 구현
    - 상세 오류 정보 로깅 및 스택 트레이스 저장
    - 오류 발생 패턴 분석 및 리포트 생성 기능
    - _요구사항: 8.1, 8.2, 8.3_

  - [ ] 9.2 구조화된 로깅 시스템 구현
    - JSON 형식 로그 출력 및 로그 로테이션 설정
    - 서비스별 로그 레벨 관리 기능 구현
    - 중앙화된 로그 수집 및 검색 시스템 구축
    - _요구사항: 8.1, 8.2, 8.3_

- [ ] 10. 성능 최적화 및 캐싱 시스템 구현
  - [ ] 10.1 Redis 기반 캐싱 시스템 구현
    - 검색 결과 캐싱 로직 구현 (1시간 TTL)
    - 문서 임베딩 캐싱 시스템 구현 (24시간 TTL)
    - 캐시 무효화 및 갱신 전략 구현
    - _요구사항: 6.1, 6.5_

  - [ ] 10.2 모델 최적화 및 양자화 구현
    - 모델 양자화를 통한 메모리 사용량 최적화
    - 모델 캐싱 및 지연 로딩 시스템 구현
    - GPU 메모리 관리 및 배치 처리 최적화
    - _요구사항: 4.3, 4.4_

- [ ] 11. 보안 및 인증 시스템 구현
  - [ ] 11.1 JWT 기반 인증 시스템 구현
    - 토큰 생성, 검증, 갱신 로직 구현
    - 사용자 권한 관리 및 역할 기반 접근 제어
    - API 엔드포인트별 권한 검증 미들웨어 추가
    - _요구사항: 6.1, 6.5_

  - [ ] 11.2 데이터 암호화 및 보안 강화
    - 민감한 문서 내용 AES 암호화 구현
    - 데이터베이스 연결 문자열 암호화
    - 로그 파일 암호화 및 접근 제어 설정
    - _요구사항: 1.1, 1.3_

- [ ] 12. 테스트 및 품질 보증
  - [ ] 12.1 단위 테스트 구현
    - 각 서비스의 핵심 로직 단위 테스트 작성
    - pytest 기반 테스트 프레임워크 설정
    - 테스트 커버리지 80% 이상 달성
    - _요구사항: 모든 요구사항_

  - [ ] 12.2 통합 테스트 구현
    - 서비스 간 인터페이스 통합 테스트 작성
    - 전체 파이프라인 end-to-end 테스트 구현
    - testcontainers를 활용한 격리된 테스트 환경 구축
    - _요구사항: 모든 요구사항_

  - [ ] 12.3 성능 테스트 구현
    - locust를 활용한 부하 테스트 시나리오 작성
    - 검색 응답 시간 1초 이내 목표 달성 검증
    - 동시 사용자 100명 처리 성능 테스트
    - _요구사항: 6.1, 6.5_

- [ ] 13. 배포 및 운영 환경 구성
  - [ ] 13.1 Docker 컨테이너화 완성
    - 각 서비스별 최적화된 Dockerfile 작성
    - 멀티 스테이지 빌드를 통한 이미지 크기 최적화
    - 보안 스캔 및 취약점 검사 자동화
    - _요구사항: 모든 요구사항_

  - [ ] 13.2 Docker Compose 및 오케스트레이션 설정
    - 전체 시스템 Docker Compose 설정 완성
    - 서비스 간 네트워크 및 볼륨 설정
    - 환경별 설정 파일 분리 (개발/스테이징/프로덕션)
    - _요구사항: 모든 요구사항_

  - [ ] 13.3 모니터링 및 헬스체크 시스템 구현
    - 각 서비스별 헬스체크 엔드포인트 구현
    - Prometheus 메트릭 수집 설정
    - Grafana 대시보드 구성
    - 알림 규칙 및 에스컬레이션 정책 설정
    - _요구사항: 8.3, 10.5_