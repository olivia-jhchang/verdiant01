# 요구사항 문서

## 개요

지능형 검색 시스템은 공공기관 내부 서버에 설치되어 기관 내 RDB와 연결하여 행정·민원·조례 문서를 자동으로 수집, 벡터화, 인덱싱하고 RAG 기반 검색 서비스를 제공하는 시스템입니다. 외부 네트워크나 크롤링을 사용하지 않고 내부 데이터베이스만을 활용하여 보안성을 확보합니다.

## 요구사항

### 요구사항 1

**사용자 스토리:** 시스템 관리자로서 JDBC/ODBC를 사용하여 내부 데이터베이스에 연결하고 싶다. 외부 의존성 없이 기존 문서 데이터에 접근하기 위해서이다.

#### 수락 기준

1. 시스템이 시작될 때 지정된 내부 데이터베이스에 읽기 전용 권한으로 JDBC/ODBC 연결을 설정해야 한다
2. 데이터베이스 연결이 실패하면 시스템은 오류를 로그에 기록하고 지수 백오프로 연결을 재시도해야 한다
3. 데이터베이스 자격 증명이 제공되면 시스템은 데이터 추출을 진행하기 전에 연결을 검증해야 한다

### 요구사항 2

**사용자 스토리:** 시스템 관리자로서 지정된 데이터베이스 테이블에서 텍스트와 메타데이터를 자동으로 추출하고 싶다. 문서가 검색 인덱싱을 위해 처리될 수 있도록 하기 위해서이다.

#### 수락 기준

1. 데이터베이스에 연결되면 시스템은 구성된 테이블에서 텍스트 내용과 메타데이터를 추출해야 한다
2. 테이블 스키마가 변경되면 시스템은 자동으로 새로운 구조를 감지하고 적응해야 한다
3. 추출이 완료되면 시스템은 처리된 문서 수와 발생한 오류를 로그에 기록해야 한다

### 요구사항 3

**사용자 스토리:** 시스템 관리자로서 한국어 문서가 자동으로 구조화되고 의미 단위로 청킹되기를 원한다. 한국어 특성을 고려한 효율적인 벡터 검색을 위해서이다.

#### 수락 기준

1. 문서가 추출되면 시스템은 자동으로 JSON 스키마에 매핑하고 문서 타입(행정문서, 민원문서, 조례문서)을 분류해야 한다
2. 문서가 구조화되면 시스템은 한국어 문장 구조를 고려한 규칙 기반 청킹(문단, 조항, 항목 단위) 또는 LLM 보조 의미 단위 분할을 수행해야 한다
3. 청킹 시 각 청크는 최소 100자, 최대 1000자 범위 내에서 의미적 완결성을 유지해야 한다
4. 청킹이 실패하면 시스템은 실패를 로그에 기록하고 기본 문장 단위 분할로 대체해야 한다

### 요구사항 4

**사용자 스토리:** 시스템 관리자로서 한국어 텍스트 청크가 고품질 벡터 임베딩으로 변환되기를 원한다. 한국어 공공문서에 특화된 의미론적 검색이 수행될 수 있도록 하기 위해서이다.

#### 수락 기준

1. 텍스트 청크가 생성되면 시스템은 우선적으로 BGE KoBase 모델을 사용하여 768차원 벡터 임베딩으로 변환해야 한다
2. BGE KoBase 모델이 사용 불가능한 경우 시스템은 SentenceTransformer의 한국어 모델(klue/roberta-base 기반)을 대안으로 사용해야 한다
3. 벡터화가 완료되면 시스템은 벡터와 함께 원본 텍스트, 문서 ID, 청크 순서, 문서 타입 메타데이터를 벡터 데이터베이스에 저장해야 한다
4. 벡터화 과정에서 배치 처리(배치 크기 32)를 통해 성능을 최적화해야 한다
5. 벡터화가 실패하면 시스템은 오류를 로그에 기록하고 단일 문서 처리 모드로 재시도해야 한다

### 요구사항 5

**사용자 스토리:** 시스템 관리자로서 벡터가 고성능 벡터 데이터베이스에 효율적으로 인덱싱되기를 원한다. 대용량 문서에서도 빠른 유사도 검색이 수행될 수 있도록 하기 위해서이다.

#### 수락 기준

1. 벡터가 생성되면 시스템은 우선적으로 Chroma DB를 사용하여 벡터를 저장하고, 메타데이터 필터링 기능을 활용해야 한다
2. Chroma DB 사용이 불가능한 경우 시스템은 FAISS 인덱스(IVF_FLAT 또는 HNSW)를 대안으로 사용해야 한다
3. 인덱싱 시 문서 타입별로 별도 컬렉션을 생성하여 검색 성능을 최적화해야 한다
4. 인덱싱이 완료되면 시스템은 샘플 쿼리를 통해 인덱스 무결성과 응답 시간(1초 이내)을 검증해야 한다
5. 인덱스 손상이 감지되면 시스템은 백업에서 자동으로 인덱스를 복구하거나 재구축해야 한다

### 요구사항 6

**사용자 스토리:** 최종 사용자로서 한국어 자연어 쿼리를 사용하여 공공문서를 검색하고 정확한 답변을 받고 싶다. 행정업무에 필요한 정보를 빠르고 정확하게 찾을 수 있도록 하기 위해서이다.

#### 수락 기준

1. 사용자가 한국어 쿼리를 제출하면 시스템은 동일한 임베딩 모델로 쿼리를 벡터화하고 코사인 유사도 기반 검색을 수행해야 한다
2. 검색 시 Top-K(기본값 5) 관련 문서 청크를 반환하고, 유사도 점수 0.7 이상인 결과만 사용해야 한다
3. 관련 청크가 발견되면 시스템은 KoAlpaca 또는 LLaMA 2 7B/13B 모델을 사용하여 한국어 공공문서 스타일의 응답을 생성해야 한다
4. LLM 응답 생성 시 명세화된 프롬프트 템플릿을 사용하여 일관된 답변 형식을 유지해야 한다
5. 검색이 완료되면 시스템은 답변과 함께 소스 문서명, 해당 조항/항목, 신뢰도 점수를 반환해야 한다
6. 관련 문서가 없거나 신뢰도가 낮은 경우 "관련 정보를 찾을 수 없습니다"라고 명시해야 한다

### 요구사항 7

**사용자 스토리:** 시스템 관리자로서 AutoEval 기반의 자동화된 성능 평가를 원한다. 검색 정확도와 응답 품질을 지속적으로 모니터링하고 개선할 수 있도록 하기 위해서이다.

#### 수락 기준

1. 평가가 예약되면 시스템은 미리 준비된 질문-정답 데이터셋을 사용하여 자동화된 테스트를 실행해야 한다
2. 평가 시 Top-1, Top-3, Top-5 정확도, MRR(Mean Reciprocal Rank), NDCG@K 지표를 계산해야 한다
3. LLM 응답 품질 평가를 위해 BLEU, ROUGE, BERTScore 지표를 측정해야 한다
4. 평가가 완료되면 시스템은 성능 지표 변화 추이와 함께 상세 보고서를 생성해야 한다
5. 성능이 기준치(Top-5 정확도 80%) 이하로 저하되면 시스템은 관리자에게 알리고 재인덱싱 또는 모델 교체를 제안해야 한다
6. 평가는 cron 또는 APScheduler를 통해 주간 단위로 자동 실행되어야 한다

### 요구사항 8

**사용자 스토리:** 시스템 관리자로서 포괄적인 오류 모니터링과 로깅을 원한다. 시스템 문제를 빠르게 식별하고 해결할 수 있도록 하기 위해서이다.

#### 수락 기준

1. 청킹이 실패하면 시스템은 자동으로 감지하고 상세한 오류 정보를 로그에 기록해야 한다
2. 인덱싱 오류가 발생하면 시스템은 오류를 로그에 기록하고 복구 절차를 시도해야 한다
3. 시스템 오류가 감지되면 시스템은 관리자에게 실행 가능한 진단 정보를 제공해야 한다

### 요구사항 9

**사용자 스토리:** 시스템 관리자로서 배치 처리 기능을 원한다. 대용량 문서 컬렉션을 효율적으로 처리할 수 있도록 하기 위해서이다.

#### 수락 기준

1. 배치 처리가 시작되면 시스템은 구성 가능한 배치 크기로 문서를 처리해야 한다
2. 배치 처리가 실행되면 시스템은 진행 상황 업데이트와 예상 완료 시간을 제공해야 한다
3. 배치 처리가 중단되면 시스템은 마지막 성공한 체크포인트부터 재개해야 한다

### 요구사항 10

**사용자 스토리:** 시스템 관리자로서 cron 또는 APScheduler 기반의 예약된 작업을 원한다. 문서 인덱싱과 평가가 자동으로 실행되어 시스템이 최신 상태를 유지할 수 있도록 하기 위해서이다.

#### 수락 기준

1. 일정이 구성되면 시스템은 APScheduler를 사용하여 지정된 간격(일간/주간/월간)으로 문서 수집과 인덱싱을 실행해야 한다
2. 배치 실행 시 시스템은 증분 업데이트 방식으로 변경된 문서만 처리하여 효율성을 높여야 한다
3. 예약된 작업이 실행되면 시스템은 처리된 문서 수, 소요 시간, 오류 발생 건수를 로그에 기록해야 한다
4. 예약된 작업이 실패하면 시스템은 최대 3회까지 재시도하고, 최종 실패 시 관리자에게 이메일 또는 시스템 알림을 발송해야 한다
5. 시스템은 작업 실행 이력과 성능 통계를 웹 대시보드를 통해 제공해야 한다